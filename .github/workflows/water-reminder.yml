name: Water Reminder

on:
  workflow_dispatch:
  schedule:
    - cron: "0 * * * *"
      # normal reminders
    - cron: "30 21 * * *"      # night summary
    - cron: "0 9 * * 1"        # weekly summary (Monday 9 AM)
  repository_dispatch:
    types:
      [
        goal_completed,
        progress_25,
        progress_50,
        progress_75,
        missed_alert,
        night_summary,
        weekly_summary,
        smart_reminder
      ]

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram message
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          EVENT="${{ github.event.action || github.event_name }}"

          case "$EVENT" in
            progress_25)
              MESSAGE="ğŸ’§ 25% hydration done. Good start!"
              ;;
            progress_50)
              MESSAGE="ğŸ’§ 50% done. Keep going!"
              ;;
            progress_75)
              MESSAGE="ğŸ’§ 75% done. Almost there!"
              ;;
            goal_completed)
              MESSAGE="ğŸ‰ Goal completed! Excellent hydration today ğŸ’ª"
              ;;
            missed_alert)
              MESSAGE="âš ï¸ You missed a reminder. Drink water now!"
              ;;
            smart_reminder)
              MESSAGE="â° You missed earlier. Drink water now ğŸ’§"
              ;;
            night_summary)
              MESSAGE="ğŸŒ™ Day completed. Check your hydration stats."
              ;;
            weekly_summary)
              MESSAGE="ğŸ“Š Weekly hydration summary is ready. Great consistency matters!"
              ;;
            *)
              MESSAGE="ğŸ’§ Time to drink water!"
              ;;
          esac

          curl --fail --silent --show-error \
          "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
          -d chat_id="${CHAT_ID}" \
          -d text="$MESSAGE"
